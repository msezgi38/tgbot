;=============================================================================
; PJSIP Configuration for MagnusBilling Trunk
;=============================================================================
; This file configures Asterisk to register with MagnusBilling as a SIP trunk
; Update the credentials in the [magnus_auth] section with your actual values
;=============================================================================

[global]
max_forwards=70
user_agent=Asterisk PBX
default_realm=sip.1337global.sbs

;-----------------------------------------------------------------------------
; Transport Configuration - UDP on port 5060
;-----------------------------------------------------------------------------
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=
external_signaling_address=

;-----------------------------------------------------------------------------
; MagnusBilling Trunk Registration
;-----------------------------------------------------------------------------
[magnus_trunk]
type=registration
transport=transport-udp
outbound_auth=magnus_auth
server_uri=sip:sip.1337global.sbs
client_uri=sip:YOUR_USERNAME@sip.1337global.sbs
retry_interval=60
max_retries=1000
auth_rejection_permanent=no
contact_user=YOUR_USERNAME

;-----------------------------------------------------------------------------
; Authentication for MagnusBilling
;-----------------------------------------------------------------------------
[magnus_auth]
type=auth
auth_type=userpass
username=YOUR_USERNAME          ; ⚠️ REPLACE WITH YOUR MAGNUSBILLING USERNAME
password=YOUR_PASSWORD          ; ⚠️ REPLACE WITH YOUR MAGNUSBILLING PASSWORD
realm=sip.1337global.sbs

;-----------------------------------------------------------------------------
; AOR (Address of Record) for MagnusBilling
;-----------------------------------------------------------------------------
[magnus_trunk]
type=aor
contact=sip:sip.1337global.sbs

;-----------------------------------------------------------------------------
; Identify - Match incoming calls from MagnusBilling
;-----------------------------------------------------------------------------
[magnus_trunk]
type=identify
endpoint=magnus_trunk
match=sip.1337global.sbs

;-----------------------------------------------------------------------------
; Endpoint Configuration for Outbound Calls
;-----------------------------------------------------------------------------
[magnus_trunk]
type=endpoint
transport=transport-udp
context=from-magnus                    ; Context for incoming calls
disallow=all                           ; Disallow all codecs first
allow=ulaw                             ; Allow G.711 μ-law
allow=alaw                             ; Allow G.711 A-law
allow=gsm                              ; Allow GSM
allow=g729                             ; Allow G.729 (if licensed)
outbound_auth=magnus_auth
aors=magnus_trunk
direct_media=no                        ; Force media through Asterisk
trust_id_outbound=yes
send_pai=yes
from_user=YOUR_USERNAME                ; ⚠️ REPLACE WITH YOUR USERNAME
from_domain=sip.1337global.sbs
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
callerid=1234567890                    ; Default CallerID, overridden per call

;-----------------------------------------------------------------------------
; Configuration Notes:
;-----------------------------------------------------------------------------
; 1. Replace YOUR_USERNAME and YOUR_PASSWORD with actual MagnusBilling credentials
; 2. The 'from_user' should match your MagnusBilling account username
; 3. CallerID will be set dynamically per call in the dialplan
; 4. After updating, test registration with: asterisk -rx "pjsip show registrations"
; 5. Check trunk status with: asterisk -rx "pjsip show endpoints"
;=============================================================================
